<div class="mapa-container">
  <!-- ğŸ›ï¸ Panel de Control -->
  <div class="controls-panel">
    <h2>ğŸ—ºï¸ Mapa de Reportes</h2>
    
    <!-- Filtros -->
    <div class="filters-section">
      <h3>Filtros</h3>
      
      <div class="filter-group">
        <label>CategorÃ­a</label>
        <select [(ngModel)]="categoriaSeleccionada" (change)="aplicarFiltros()">
          <option [value]="null">Todas las categorÃ­as</option>
          <option *ngFor="let cat of categorias" [value]="cat.id">
            {{ cat.icono }} {{ cat.nombre }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Estado</label>
        <select [(ngModel)]="estadoSeleccionado" (change)="aplicarFiltros()">
          <option [value]="null">Todos los estados</option>
          <option value="pendiente">â³ Pendiente</option>
          <option value="en_proceso">ğŸ”„ En Proceso</option>
          <option value="resuelto">âœ… Resuelto</option>
        </select>
      </div>

      <button class="btn-clear" (click)="limpiarFiltros()">
        ğŸ—‘ï¸ Limpiar Filtros
      </button>
    </div>

    <!-- Modo de Vista -->
    <div class="view-mode-section">
      <h3>Modo de Vista</h3>
      <div class="view-buttons">
        <button 
          [class.active]="modoVista === 'heatmap'"
          (click)="cambiarModoVista('heatmap')">
          ğŸ”¥ Mapa de Calor
        </button>
        <button 
          [class.active]="modoVista === 'markers'"
          (click)="cambiarModoVista('markers')">
          ğŸ“ Marcadores
        </button>
        <button 
          [class.active]="modoVista === 'clusters'"
          (click)="cambiarModoVista('clusters')">
          ğŸ¯ Clusters
        </button>
      </div>
    </div>

    <!-- EstadÃ­sticas Generales -->
    <div class="stats-section">
      <h3>ğŸ“Š EstadÃ­sticas</h3>
      <div class="stat-card">
        <span class="stat-label">Total de Reportes</span>
        <span class="stat-value">{{ totalReportes }}</span>
      </div>
    </div>

    <!-- EstadÃ­sticas de Zona (si hay) -->
    <div class="zona-stats" *ngIf="mostrandoEstadisticas && estadisticasZona">
      <h3>ğŸ“ EstadÃ­sticas de Zona</h3>
      
      <div class="stat-grid">
        <div class="stat-item">
          <span class="label">Total</span>
          <span class="value">{{ estadisticasZona.total }}</span>
        </div>
        <div class="stat-item pendiente">
          <span class="label">Pendientes</span>
          <span class="value">{{ estadisticasZona.pendientes }}</span>
        </div>
        <div class="stat-item proceso">
          <span class="label">En Proceso</span>
          <span class="value">{{ estadisticasZona.en_proceso }}</span>
        </div>
        <div class="stat-item resuelto">
          <span class="label">Resueltos</span>
          <span class="value">{{ estadisticasZona.resueltos }}</span>
        </div>
      </div>

      <div class="categoria-stats">
        <h4>Por CategorÃ­a</h4>
        <div 
          *ngFor="let cat of estadisticasZona.por_categoria" 
          class="categoria-item"
          [style.border-left]="'4px solid ' + cat.color">
          <span>{{ cat.nombre }}</span>
          <span class="badge">{{ cat.total }}</span>
        </div>
      </div>

      <button class="btn-close" (click)="mostrandoEstadisticas = false">
        Cerrar
      </button>
    </div>
  </div>

  <!-- ğŸ—ºï¸ Mapa -->
  <div class="map-wrapper">
    <div id="mapa-calor-container" class="map-container"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="spinner"></div>
      <p>Cargando datos del mapa...</p>
    </div>
  </div>
</div>