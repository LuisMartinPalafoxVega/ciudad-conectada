<div class="nuevo-reporte-container">
  <div class="header">
    <h1>Crear Nuevo Reporte</h1>
    <p>Reporta problemas en tu comunidad para que puedan ser atendidos</p>
  </div>

  <form [formGroup]="reporteForm" (ngSubmit)="onSubmit()" class="reporte-form">
    <div class="form-section">
      <h2>Informaci√≥n del Reporte</h2>
      
      <div class="form-group">
        <label for="titulo">T√≠tulo del reporte *</label>
        <input
          id="titulo"
          type="text"
          formControlName="titulo"
          placeholder="Ej: Bache peligroso en avenida principal"
          [class.invalid]="titulo?.invalid && titulo?.touched"
        />
        <div class="error-message" *ngIf="titulo?.invalid && titulo?.touched">
          <span *ngIf="titulo?.errors?.['required']">El t√≠tulo es requerido</span>
          <span *ngIf="titulo?.errors?.['maxlength']">M√°ximo 200 caracteres</span>
        </div>
      </div>

      <div class="form-group">
        <label for="descripcion">Descripci√≥n *</label>
        <textarea
          id="descripcion"
          formControlName="descripcion"
          rows="5"
          placeholder="Describe el problema con el mayor detalle posible..."
          [class.invalid]="descripcion?.invalid && descripcion?.touched"
        ></textarea>
        <div class="error-message" *ngIf="descripcion?.invalid && descripcion?.touched">
          <span *ngIf="descripcion?.errors?.['required']">La descripci√≥n es requerida</span>
          <span *ngIf="descripcion?.errors?.['maxlength']">M√°ximo 1000 caracteres</span>
        </div>
      </div>

      <div class="form-group">
        <label for="categoria">Categor√≠a *</label>
        <select
          id="categoria"
          formControlName="categoria_id"
          [class.invalid]="categoria_id?.invalid && categoria_id?.touched"
        >
          <option value="">Selecciona una categor√≠a</option>
          <option *ngFor="let cat of categorias" [value]="cat.id">
            {{ cat.nombre }}
          </option>
        </select>
        <div class="error-message" *ngIf="categoria_id?.invalid && categoria_id?.touched">
          <span *ngIf="categoria_id?.errors?.['required']">Selecciona una categor√≠a</span>
        </div>
      </div>

      <div class="form-group">
        <label for="direccion">Direcci√≥n de referencia</label>
        <input
          id="direccion"
          type="text"
          formControlName="direccion_referencia"
          placeholder="Ej: Calle Hidalgo #123, Col. Centro"
        />
      </div>
    </div>

    <div class="form-section">
      <h2>Ubicaci√≥n en el Mapa *</h2>
      <p class="help-text">
        Haz clic en el mapa para marcar la ubicaci√≥n exacta del problema
      </p>
      
      <button type="button" class="btn-location" (click)="useMyLocation()">
        üìç Usar mi ubicaci√≥n actual
      </button>

      <div id="map" class="map-container"></div>

      <div class="coordinates-display" *ngIf="latitud?.value && longitud?.value">
        <div class="coord-item">
          <span class="coord-label">Latitud:</span>
          <span class="coord-value">{{ latitud?.value }}</span>
        </div>
        <div class="coord-item">
          <span class="coord-label">Longitud:</span>
          <span class="coord-value">{{ longitud?.value }}</span>
        </div>
      </div>

      <div class="error-message" *ngIf="(latitud?.invalid || longitud?.invalid) && (latitud?.touched || longitud?.touched)">
        <span>Debes marcar la ubicaci√≥n en el mapa</span>
      </div>
    </div>

    <div class="form-section">
      <h2>Imagen (Opcional)</h2>
      <p class="help-text">Sube una foto del problema para mejor contexto</p>

      <div class="image-upload" *ngIf="!imagenPreview">
        <label for="imagen" class="upload-label">
          <div class="upload-icon">üì∑</div>
          <span>Haz clic para subir una imagen</span>
          <span class="upload-hint">JPG o PNG, m√°ximo 5MB</span>
        </label>
        <input
          id="imagen"
          type="file"
          accept="image/jpeg,image/png,image/jpg"
          (change)="onImageSelected($event)"
          style="display: none;"
        />
      </div>

      <div class="image-preview" *ngIf="imagenPreview">
        <img [src]="imagenPreview" alt="Vista previa" />
        <button type="button" class="btn-remove-image" (click)="removeImage()">
          ‚úï Remover imagen
        </button>
      </div>
    </div>

    <div class="error-message" *ngIf="error">{{ error }}</div>

    <div class="form-actions">
      <button type="button" class="btn-cancel" routerLink="/reportes">
        Cancelar
      </button>
      <button type="submit" class="btn-submit" [disabled]="loading || reporteForm.invalid">
        {{ loading ? 'Creando reporte...' : 'Crear Reporte' }}
      </button>
    </div>
  </form>
</div>